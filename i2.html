<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manifest Display</title>
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css">
    <style>
        /* Swiper default styles */
        .swiper-container {
            width: 100%;
            height: 200px;
        }

        .swiper-slide {
            text-align: center;
            font-size: 18px;
            background: #fff;

            /* Center slide text vertically */
            display: flex;
            justify-content: center;
            align-items: center;
        }
    </style>
</head>

<body>

    <h1 id="pageTitle">Select a theme</h1>

    <select id="folderDropdown" onchange="loadFiles()">
        <option value="">Select a theme...</option>
    </select>

    <div id="displayContainer">
        <!-- The extracted content will be displayed here -->
    </div>

    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
    <script>
        const BASE_URL = 'https://raw.githubusercontent.com/thqrs/wordblocks/main/';

        const patterns = {
            "Engage": /Engage:\s*([\s\S]*?)(?=\n\s*Set the Objective:)/,
            "Set the Objective": /Set the Objective:\s*([\s\S]*?)(?=\n\s*Highlight the Value:)/,
            "Highlight the Value": /Highlight the Value:\s*([\s\S]*?)(?=\nBiblical Exploration:)/,
            "Reiterate the Question": /Reiterate the Question:\s*([\s\S]*?)(?=\n\s*Reading the Passage:)/,
            "Reading the Passage": /Reading the Passage:\s*([\s\S]*?)(?=\n\s*Clarification:)/,
            "Clarification": /Clarification:\s*([\s\S]*?)(?=\n\s*Illustration:)/,
            "Illustration": /Illustration:\s*([\s\S]*?)(?=\n\s*Application:)/,
            "Application": /Application:\s*([\s\S]*?)(?=\n\s*Transition:)/,
            "Transition": /Transition:\s*([\s\S]*?)(?=\n\s*Reiterate the Question:)/,
            "Second Reiterate the Question": /Transition:.*?Reiterate the Question:\s*([\s\S]*?)(?=\n\s*Reading the Passage:)/s,
            "Recap": /Recap:\s*([\s\S]*?)(?=\n\s*Call to Action:)/,
            "Call to Action": /Call to Action:\s*([\s\S]*?)(?=\n\s*Highlight Benefits:)/,
            "Highlight Benefits": /Highlight Benefits:\s*([\s\S]*?)(?=\n\s*Closing Thought:)/,
            "Closing Thought": /Closing Thought:\s*([\s\S]*?)(?=\nPhrase to sum up the talk:)/,
            "Phrase to sum up the talk": /Phrase to sum up the talk:\s*"([\s\S]*?)"/
        };

        window.onload = function () {
            fetch('manifest.json')
                .then(response => response.json())
                .then(data => {
                    const dropdown = document.getElementById('folderDropdown');
                    Object.keys(data.folders).forEach(folder => {
                        const option = document.createElement('option');
                        option.value = folder;
                        option.textContent = folder;
                        dropdown.appendChild(option);
                    });
                });
        };
        
        function loadFiles() {
            const theme = document.getElementById('folderDropdown').value;
            if (!theme) return;

            document.getElementById('pageTitle').textContent = theme;
            const container = document.getElementById('displayContainer');
            container.innerHTML = ''; // Clear previous content
        
            fetch('manifest.json')
                .then(response => response.json())
                .then(data => {
                    let allSections = {};
                    let promises = [];

                    for (let section in patterns) {
                        allSections[section] = [];
                    }

                    data.folders[theme].forEach(fileName => {
                        const filePromise = fetch(BASE_URL + encodeURIComponent(theme) + '/' + encodeURIComponent(fileName))
                            .then(response => response.text())
                            .then(content => {
                                console.log(`Content of ${fileName}:`, content); // Log the content for debugging
                                const extractedSections = extractSections(content);
                                for (let section in patterns) {
                                    allSections[section].push(extractedSections[section]);
                                }
                            });

                        promises.push(filePromise);
                    });

                    Promise.all(promises).then(() => {
                        displayData(allSections);
                    });
                });
        }

        function extractSections(content) {
            let results = {};
            for (let section in patterns) {
                let match = content.match(patterns[section]);
                results[section] = match ? match[1].trim() : "Not found";
            }
            return results;
        }

        function displayData(allSections) {
            const container = document.getElementById('displayContainer');
            
            Object.keys(patterns).forEach(h2Name => {
                const sectionDiv = document.createElement('div');
                
                const h2 = document.createElement('h2');
                h2.textContent = h2Name;
                sectionDiv.appendChild(h2);

                const swiperContainer = document.createElement('div');
                swiperContainer.className = 'swiper-container';

                const swiperWrapper = document.createElement('div');
                swiperWrapper.className = 'swiper-wrapper';

                allSections[h2Name].forEach(sectionContent => {
                    const slideDiv = document.createElement('div');
                    slideDiv.className = 'swiper-slide';
                    slideDiv.textContent = sectionContent;
                    swiperWrapper.appendChild(slideDiv);
                });

                swiperContainer.appendChild(swiperWrapper);
                sectionDiv.appendChild(swiperContainer);
                container.appendChild(sectionDiv);
            });

            new Swiper('.swiper-container');
        }
    </script>
</body>

</html>
